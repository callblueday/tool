# åŸæœ‰è®¾ç½® {{{1
# Lines configured by zsh-newuser-install
_zdir=${ZDOTDIR:-$HOME}
HISTFILE=${_zdir}/.histfile
HISTSIZE=10000
SAVEHIST=10000
unsetopt beep
# End of lines configured by zsh-newuser-install
# The following lines were added by compinstall
zstyle :compinstall filename "$_zdir/.zshrc"

fpath=($_zdir/.zsh/Completion $_zdir/.zsh/functions $fpath)
autoload -Uz compinit
compinit
# End of lines added by compinstall

# ç¡®å®šç¯å¢ƒ {{{1
OS=${$(uname)%_*}
if [[ $OS == "CYGWIN" ]]; then
  OS=Linux
elif [[ $OS == "Darwin" ]]; then
  OS=FreeBSD
fi
unsetopt nomatch
# é€‰é¡¹è®¾ç½®{{{1
# ä¸éœ€è¦æ‰“ cdï¼Œç›´æ¥è¿›å…¥ç›®å½•
setopt autocd
# è‡ªåŠ¨è®°ä½å·²è®¿é—®ç›®å½•æ ˆ
setopt auto_pushd
setopt pushd_ignore_dups
# rm * æ—¶ä¸è¦æç¤º
setopt rm_star_silent
# å…è®¸åœ¨äº¤äº’æ¨¡å¼ä¸­ä½¿ç”¨æ³¨é‡Š
setopt interactive_comments
# disown åè‡ªåŠ¨ç»§ç»­è¿›ç¨‹
setopt auto_continue
setopt extended_glob
# å•å¼•å·ä¸­çš„ '' è¡¨ç¤ºä¸€ä¸ª ' ï¼ˆå¦‚åŒ Vimscript ä¸­è€…ï¼‰
setopt rc_quotes
# è¡¥å…¨åˆ—è¡¨ä¸åŒåˆ—å¯ä»¥ä½¿ç”¨ä¸åŒçš„åˆ—å®½
setopt listpacked
# ä¸ºæ–¹ä¾¿å¤åˆ¶ï¼Œå³è¾¹çš„æç¤ºç¬¦åªåœ¨æœ€æ–°çš„æç¤ºç¬¦ä¸Šæ˜¾ç¤º
setopt transient_rprompt
# setopt çš„è¾“å‡ºæ˜¾ç¤ºé€‰é¡¹çš„å¼€å…³çŠ¶æ€
setopt ksh_option_print
setopt no_bg_nice
# setopt noflowcontrol åœ¨ tmux ä¸­ä¸èµ·ä½œç”¨
stty -ixon
# å†å²è®°å½•{{{3
# ä¸ä¿ç•™é‡å¤çš„å†å²è®°å½•é¡¹
setopt hist_ignore_all_dups
# åœ¨å‘½ä»¤å‰æ·»åŠ ç©ºæ ¼ï¼Œä¸å°†æ­¤å‘½ä»¤æ·»åŠ åˆ°è®°å½•æ–‡ä»¶ä¸­
setopt hist_ignore_space
# zsh 4.3.6 doesn't have this option
setopt hist_fcntl_lock 2>/dev/null
setopt hist_reduce_blanks

# zstyle {{{1
# è‡ªåŠ¨è¡¥å…¨ {{{2
# ç”¨æœ¬ç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹è¡¥å…¨
zstyle ':completion:*:processes' command 'ps -afu$USER|awk ''{sub("[[:space:]]+$", "", $0); t=""; for(i=8;i<=NF;i++)t=t" "$i; p=substr($0, 1, length($0)-length(t)); sub("^ [^[:space:]]*/", " ", t); print p t}'''
zstyle ':completion:*:*:*:*:processes' force-list always
# è¿›ç¨‹åè¡¥å…¨
zstyle ':completion:*:processes-names' command  'ps c -u ${USER} -o command | uniq'

# è­¦å‘Šæ˜¾ç¤ºä¸ºçº¢è‰²
zstyle ':completion:*:warnings' format $'\e[01;31m -- No Matches Found --\e[0m'
# æè¿°æ˜¾ç¤ºä¸ºæ·¡è‰²
zstyle ':completion:*:descriptions' format $'\e[2m -- %d --\e[0m'
zstyle ':completion:*:corrections' format $'\e[01;33m -- %d (errors: %e) --\e[0m'

# cd è¡¥å…¨é¡ºåº
zstyle ':completion:*:-tilde-:*' group-order 'named-directories' 'path-directories' 'users' 'expand'
# åœ¨ .. åä¸è¦å›åˆ°å½“å‰ç›®å½•
zstyle ':completion:*:cd:*' ignore-parents parent pwd
zstyle ':completion:*:man:*' separate-sections true

zstyle ':completion:*' menu select
# åˆ†ç»„æ˜¾ç¤º
zstyle ':completion:*' group-name ''
# æ¨¡ç³ŠåŒ¹é…
# åœ¨æœ€åå°è¯•ä½¿ç”¨æ–‡ä»¶å
zstyle ':completion:*' completer _complete _match _approximate _ignored _files
# ä¿®æ­£å¤§å°å†™
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}'

# ä½¿ç”¨ç¼“å­˜ã€‚æŸäº›å‘½ä»¤çš„è¡¥å…¨å¾ˆè€—æ—¶çš„ï¼ˆå¦‚ aptitudeï¼‰
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ${_dir}/.zsh/cache
zstyle -e ':completion:*' special-dirs \
  '[[ $PREFIX == (../)#(|.|..) ]] && reply=(..)'

compdef pkill=killall
compdef pgrep=killall
compdef vman=man
compdef proxychains=command
compdef watch=command
compdef rlwrap=command
compdef ptyless=command
compdef grc=command
compdef agg=ag 2>/dev/null
compdef downgrade=pactree 2>/dev/null

# æˆ‘çš„è‡ªåŠ¨è¡¥å…¨ {{{2
# è¡¥å…¨ pdf2png
zstyle ':completion:*:*:pdf2png:*' file-patterns \
  '*.pdf:pdf\ files *(-/):directories'
zstyle ':completion:*:*:x:*' file-patterns \
'*.{7z,bz2,gz,rar,tar,tbz,tgz,zip,chm,xz,exe,xpi,apk}:compressed\ files *(-/):directories'
zstyle ':completion:*:*:evince:*' file-patterns \
'*.{pdf,ps,eps,dvi,pdf.gz,ps.gz,dvi.gz}:documents *(-/):directories'
zstyle ':completion:*:*:gbkunzip:*' file-patterns '*.zip'
zstyle ':completion:*:*:luit:*' file-patterns '*(*)'
zstyle ':completion:*:*:flashplayer:*' file-patterns '*.swf'
zstyle ':completion:*:*:hp2ps:*' file-patterns '*.hp'
zstyle ':completion:*:*:feh:*' file-patterns '*.{png,gif,jpg,svg}:images' '*(-/):directories'
zstyle ':completion:*:*:sxiv:*' file-patterns '*.{png,gif,jpg}:images *(-/):directories'
zstyle ':completion:*:*:timidity:*' file-patterns '*.mid'

# å‘½ä»¤è¡Œç¼–è¾‘{{{1
bindkey -e

# ^Xe ç”¨$EDITORç¼–è¾‘å‘½ä»¤
autoload -Uz edit-command-line
zle -N edit-command-line
zle -C complete-file menu-expand-or-complete _generic
zstyle ':completion:complete-file:*' completer _files

autoload -Uz url-quote-magic
zle -N self-insert url-quote-magic

insert-last-word-r () {
  zle insert-last-word -- 1
}
zle -N insert-last-word-r
bindkey "\e_" insert-last-word-r

# Not works with my insert-last-word-r
# autoload -Uz smart-insert-last-word
# zle -N insert-last-word smart-insert-last-word

# autoload -Uz zsh-movement
# zle -N zsh-backward-word zsh-movement
# zle -N zsh-forward-word zsh-movement
# bindkey "\eB" zsh-backward-word
# bindkey "\eF" zsh-forward-word

autoload -Uz prefix-proxy
zle -N prefix-proxy
bindkey "^Xp" prefix-proxy

zmodload zsh/complist
bindkey -M menuselect '^O' accept-and-infer-next-history

bindkey "^X^I" complete-file
bindkey "^U" backward-kill-line
bindkey "^]" vi-find-next-char
bindkey "\e]" vi-find-prev-char
bindkey "\eq" push-line-or-edit
bindkey -s "\e[Z" "^P"
bindkey '^Xa' _expand_alias
bindkey '^X^E' edit-command-line
bindkey '^[/' _history-complete-older
bindkey '\e ' set-mark-command
# ç”¨å•å¼•å·å¼•èµ·æœ€åä¸€ä¸ªå•è¯
# FIXME å¦‚ä½•å¼•èµ·å…‰æ ‡å¤„çš„å•è¯ï¼Ÿ
bindkey -s "^['" "^[] ^f^@^e^[\""
# æ‰“å¼€ zsh çš„PDFæ ¼å¼æ–‡æ¡£
bindkey -s "^X^D" "evince ~/æ–‡æ¡£/ç¼–ç¨‹/shell/zsh/zsh.pdf &^M"
bindkey -s "^Xc" "tmux attach -d -t 1^M"
# look for a command that started like the one starting on the command line {{{3
# http://www.xsteve.at/prg/zsh/.zshrc
function history-search-end {
  integer ocursor=$CURSOR

  if [[ $LASTWIDGET = history-beginning-search-*-end ]]; then
    # Last widget called set $hbs_pos.
    CURSOR=$hbs_pos
  else
    hbs_pos=$CURSOR
  fi

  if zle .${WIDGET%-end}; then
    # success, go to end of line
    zle .end-of-line
  else
    # failure, restore position
    CURSOR=$ocursor
    return 1
  fi
}
zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
bindkey '^[p' history-beginning-search-backward-end
bindkey '^[n' history-beginning-search-forward-end
# è¯ç•Œåƒ bash é‚£æ ·{{{3
# autoload -U select-word-style
# select-word-style bash
# Esc-Esc åœ¨å½“å‰/ä¸Šä¸€æ¡å‘½ä»¤å‰æ’å…¥ sudo {{{3
sudo-command-line() {
    [[ -z $BUFFER ]] && zle up-history
    [[ $BUFFER != sudo\ * ]] && BUFFER="sudo ${BUFFER% }"
    zle end-of-line #å…‰æ ‡ç§»åŠ¨åˆ°è¡Œæœ«
}
zle -N sudo-command-line
bindkey "\e\e" sudo-command-line
# æ’å…¥å½“å‰çš„æ‰€æœ‰è¡¥å…¨ http://www.zsh.org/mla/users/2000/msg00601.html {{{3
_insert_all_matches () {
    setopt localoptions nullglob rcexpandparam extendedglob noshglob
    unsetopt markdirs globsubst shwordsplit nounset ksharrays
    compstate[insert]=all
    compstate[old_list]=keep
    _complete
}
zle -C insert-all-matches complete-word _insert_all_matches
bindkey '^Xi' insert-all-matches
# åˆ«å {{{1
# å‘½ä»¤åˆ«å {{{2
alias ll='ls -lh'
alias la='ls -A'
alias rsync="rsync '--exclude=*~' '--exclude=*.swp'"
if [[ $OS == 'Linux' ]]; then
  alias ls='ls --color=auto'
  [[ -n $commands[dircolors] ]] && eval "`dircolors -b`"
  zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
elif [[ $OS == 'FreeBSD' ]]; then
  alias ls='ls -G'
else
  alias ls='ls -F'
fi
if [[ $OS == 'Linux' || $OS == 'FreeBSD' ]]; then
  alias grep='grep --color=auto'
fi
alias n='nautilus --no-desktop'
alias py='python3'
alias svim="vim -i NONE"
alias rv='EDITOR="vim --servername GVIM --remote-tab-wait"'
alias :q="exit"
alias 7z="7z '-xr!*~' '-xr!*.swp'"
alias mytex=". ~/soft/context/tex/setuptex"
[[ -n $commands[zhcon] ]] && alias zhcon="zhcon --utf8"
[[ -n $commands[luit] ]] && alias gbk="luit -encoding gbk"
[[ -n $commands[hp2ps] ]] && alias hp2ps="hp2ps -c"
[[ -n $commands[html2text] ]] && alias html2text="html2text -nobs -style pretty"
[[ -n $commands[ilua] ]] && alias ilua='rlwrap ilua'
[[ -n $commands[psh] ]] && alias psh='rlwrap psh'
[[ -n $commands[ccal] ]] && alias ccal='ccal -ub'
[[ -n $commands[zbarcam] ]] && alias zbarcam='LD_PRELOAD=/usr/lib/libv4l/v4l1compat.so zbarcam'
[[ -n $commands[tree] ]] && alias tree='tree -CN'
[[ -n $commands[l] ]] || alias l='locate'
[[ -n $commands[lre] ]] || alias lre='locate -b --regex'
[[ -n $commands[lrew] ]] || alias lrew='locate --regex'

alias winxp="VBoxManage startvm WinXP"
alias winxp2="VBoxManage startvm WinXP_test"
alias dmount="udisks --mount"
alias ren="vim +'Ren'"
# æŸ¥çœ‹è¿›ç¨‹æ•°æœ€å¤šçš„ç¨‹åº
alias topnum="ps -e|sort -k4|awk '{print \$4}'|uniq -c|sort -n|tail"
alias soul="mplayer -really-quiet -nolirc -loop 0 ~/éŸ³ä¹/_çº¯éŸ³ä¹/å¿§ä¼¤è¿˜æ˜¯å¿«ä¹.mp3"
alias xcp="rsync -aviHK --delete --exclude='*~' --exclude=__pycache__"
alias pm-suspend=mysuspend
alias pm-hibernate="leave; sleep 1; dbus-send --system --print-reply --dest=org.freedesktop.UPower /org/freedesktop/UPower org.freedesktop.UPower.Hibernate"

# åç¼€åˆ«å {{{2
alias -s xsl="vim"
alias -s {html,htm}="firefox"
alias -s {pdf,ps}="evince"
alias -s ttf="gnome-font-viewer"
alias -s {png,jpg,gif}="feh"
alias -s jar="java -jar"
alias -s swf="flashplayer"

# è·¯å¾„åˆ«å {{{2
hash -d tmp="$HOME/tmpfs"
hash -d txtfiles="/ldata/txtfiles"
hash -d SJ='/media/SJ'
hash -d phone='/media/PHONE CARD'
hash -d gtk="$HOME/scripts/c/gtk"
hash -d py="$HOME/scripts/python"
hash -d ebook="$HOME/temp/ebook"
hash -d ff="$HOME/.mozilla/firefox/profile"
hash -d wuala="$HOME/wuala/WualaDrive/lilydjwg"

# å…¨å±€åˆ«å {{{2
# å½“å‰ç›®å½•ä¸‹æœ€åä¿®æ”¹çš„æ–‡ä»¶
# æ¥è‡ª http://roylez.heroku.com/2010/03/06/zsh-recent-file-alias.html
alias -g NN="*(oc[1])"
alias -g NUL="/dev/null"
alias -g XS='$(xsel)'
alias -g ANYF='**/*[^~](.)'

# å‡½æ•° {{{1
autoload zargs
TRAPTERM () { exit }
eval "update () { . $_zdir/.zshrc }"
[[ -n $commands[strace] ]] && strace () { command strace $@ 3>&1 1>&2 2>&3 | vim -R - }
[[ -n $commands[ltrace] ]] && ltrace () { command ltrace $@ 3>&1 1>&2 2>&3 | vim -R - }
vman () { vim +"set ft=man" +"Man $@" }
song () { find ~/éŸ³ä¹ -iname "*$1*" }
mvpc () { mv $1 "`echo $1|ascii2uni -a J`" } # å°†ä»¥ %HH è¡¨ç¤ºçš„æ–‡ä»¶åæ”¹æ­£å¸¸
nocolor () { sed -r "s:\x1b\[[0-9;]*[mK]::g" }
sshpubkey () { tee < ~/.ssh/id_rsa.pub >(xsel -i) }
breakln () { #æ–­æ‰è½¯é“¾æ¥ {{{2
  for f in $@; do
    tgt=$(readlink "$f")
    unlink "$f"
    cp -r "$tgt" "$f"
  done
}
if [[ $TERM == screen* ]]; then # {{{2 è®¾ç½®æ ‡é¢˜
  # æ³¨ï¼šä¸æ”¯æŒä¸­æ–‡
  title () { echo -ne "\ek$*\e\\" }
else
  title () { echo -ne "\e]0;$*\a" }
fi
if [[ $TERM == xterm* ]] || [[ $TERM == *rxvt* ]]; then # {{{2 è®¾ç½®å…‰æ ‡é¢œè‰²
  cursorcolor () { echo -ne "\e]12;$*\007" }
elif [[ $TERM == screen* ]]; then
  if [[ -n "$TMUX" ]]; then
    cursorcolor () { echo -ne "\ePtmux;\e\e]12;$*\007\e\\" }
  else
    cursorcolor () { echo -ne "\eP\e]12;$*\007\e\\" }
  fi
fi
if [[ -d ${VIMTMP:=~/tmpfs} ]]; then # {{{2 gcc & g++
  gcc () { # {{{3
    errfile=$VIMTMP/.error
    command gcc -g -Wall $@ >$errfile 2>&1
    ret=$?
    cat $errfile
    return $ret
  }
  g++ () { # {{{3
    errfile=$VIMTMP/.error
    command g++ -g -Wall $@ >$errfile 2>&1
    ret=$?
    cat $errfile
    return $ret
  }
fi
2mp3 () { # è½¬æ¢æˆ mp3 æ ¼å¼ {{{2
  [[ $# -ne 1 ]] && echo "Usage: $0 FILE" && return 1
  mplayer -vo null -vc dummy -af resample=44100 -ao pcm:waveheader "$1" && \
  lame -m s audiodump.wav -o "$1:r.mp3" && rm audiodump.wav || \
  {echo Failed. && return 2}
}
ptyless () { # ä½¿ç”¨ä¼ªç»ˆç«¯ä»£æ›¿ç®¡é“ï¼Œå¯¹ ls è¿™ç§â€œé¡½å›ºåˆ†å­â€æœ‰æ•ˆ {{{2
  zmodload zsh/zpty
  zpty ptyless ${1+"$@"}
  zpty -r ptyless > /tmp/ptyless.$$
  less -RFX /tmp/ptyless.$$
  rm -f /tmp/ptyless.$$
  zpty -d ptyless
}
sshget () { # é€šè¿‡ ssh ä¸‹è½½æ–‡ä»¶ï¼ˆå›½å¤–ï¼‰{{{2
  if [[ $# -ne 2 ]]; then
    echo "Usage: $0 URL FILE"
    return 1
  fi
  ssh shell.cjb.net "wget -q -O - $1"|pv > $2
}
sshget2 () { # é€šè¿‡ ssh ä¸‹è½½æ–‡ä»¶ï¼ˆå›½å†…ï¼‰{{{2
  if [[ $# -ne 2 ]]; then
    echo "Usage: $0 URL FILE"
    return 1
  fi
  ssh ubuntu.unix-center.net "wget -q -O - '$1'"|pv > $2
}
mvgb () { # æ–‡ä»¶åä» GB è½¬ç ï¼Œå¸¦ç¡®è®¤{{{2
  for i in $@; do
    new="`echo $i|iconv -f utf8 -t latin1|iconv -f gbk`"
    echo $new
    echo -n 'Sure? '
    read -q ans && mv -i $i $new
    echo
  done
}
iip () { #{{{2
  qip=${1:-cip}
  echo -n "ip> "
  read ip
  while [[ $ip != 'q' ]]; do
    $qip $ip
    echo -n "ip> "
    read ip
  done
  unset ip
}
pid () { #{{{2
  s=0
  for i in $@; do
    echo -n "$i: "
    r=`cat /proc/$i/cmdline|tr '\0' ' ' 2>/dev/null`
    if [[ $? -ne 0 ]]; then
      echo not found
      s=1
    else
      echo $r
    fi
  done
  return $s
}
proxy () { #å¸¸ç”¨ä»£ç†ä¸€èµ·å¯åŠ¨{{{2
  python2 ~/src/goagent/local/proxy.py &
  # (cd ~/src/goagent/local && exec python2 ~/src/goagent/local/proxy.py)&
  # ~/soft/g/APJP/JAVA/APJP.sh&
}
s () { # å¿«é€ŸæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ {{{2
  name=$1
  shift
  find . -name "*$name*" $@
}
function en { # ä½¿ç”¨ DNS TXT è®°å½•çš„è¯å…¸ {{{2
  # https://github.com/chuangbo/jianbing-dictionary-dns
  dig "$*.jianbing.org" +short txt | perl -pe's/\\(\d{1,3})/chr $1/eg; s/(^"|"$)//g'
}
shutdown () { #{{{2
  echo -n ä½ ç¡®å®šè¦å…³æœºå—ï¼Ÿ
  read i
  if [[ $i == [Yy] ]]; then
    systemctl poweroff
    # dbus-send --system --print-reply --dest=org.freedesktop.ConsoleKit /org/freedesktop/ConsoleKit/Manager org.freedesktop.ConsoleKit.Manager.Stop
  fi
}
killssh () { #{{{2 kill all ssh that using default master socket
  pids=$(netstat -nxlp 2>/dev/null | awk -v HOME=$HOME '{if(index($10, HOME"/.ssh/master-") == 1){print $9}}' | grep -o '^[[:digit:]]\+')
  [[ -n $pids ]] && kill ${=pids}
}
tianqi () { #å¤©æ°”é¢„æŠ¥ {{{2
  if [[ $# -eq 1 ]]; then
    city=$1
  elif [[ $# -eq 0 ]]; then
    city=å—äº¬
  else
    echo "åŸå¸‚ï¼Ÿ" >&2
    return 1
  fi
  w3m -dump "http://weather1.sina.cn/dpool/weather_new/forecast_new.php?city=$city&vt=4" 2>/dev/null | sed '1,/è®¾ä¸ºå¤©æ°”é¦–é¡µ/d;/æŸ¥çœ‹æœªæ¥å¤©æ°”è¯¦æƒ…/,$d;/^\s*$/d;/åˆ†äº«/d;s/\[[^]]\+\]//g;s/^\s*//;'
}
yuntu_url () { #æœ€æ–°å«æ˜Ÿäº‘å›¾ {{{2
  curl -s --compressed http://www.weather.com.cn/static/product_video_v1.php\?class\=JC_YT_DL_WXZXCSYT | grep -E 'sevp_nsmc_wxcl_asc_e99_achn_lno_py_(.+)? w' | cut -c62-157
}
yuniodl () { #ä¸‹è½½äº‘è¯ºåˆ†äº«æ–‡ä»¶ {{{2
  token=$1
  [[ -z $token ]] && return 1
  wget -c --header "Referer: http://s.yunio.com/$token" http://s.yunio.com/public/download/token/"$token"
}
# å˜é‡è®¾ç½® {{{1
[[ -f $_zdir/.zsh/zshrc.local ]] && source $_zdir/.zsh/zshrc.local
# zsh{{{2
# æç¤ºç¬¦
# %n --- ç”¨æˆ·å
# %~ --- å½“å‰ç›®å½•
# %h --- å†å²è®°å½•å·
if [[ -n $commands[git] ]]; then
  _current_branch () {
    br=$(git branch --no-color 2>/dev/null)
    if [[ $? -eq 0 ]]; then
      echo -n "$(echo $br|awk '{if($1 == "*"){print "%{[33m%} (" substr($0, 3) ")"}}')"
    fi
  }
  setopt PROMPT_SUBST
  show_current_branch='$(_current_branch)'
fi
[[ -n $ZSH_PS_HOST && $ZSH_PS_HOST != \(*\)\  ]] && ZSH_PS_HOST="($ZSH_PS_HOST) "
PS1="%{[2m%}%h $ZSH_PS_HOST%(?..%{[1;31m%}%?%{[0m%} )%{[32m%}%~$show_current_branch
%(!.%{[0;31m%}###.%{[1;34m%}>>>)%{[0m%} "
# æ¬¡æç¤ºç¬¦ï¼šä½¿ç”¨æš—è‰²
PS2="%{[2m%}%_>%{[0m%} "
# å³è¾¹çš„æç¤º
RPS1="%(1j.%{[1;33m%}%j .)%{[m%}%T"
CORRECT_IGNORE='_*'
READNULLCMD=less

# TeX{{{2
export TEXMFCACHE=$HOME/.cache
export OSFONTDIR=$HOME/.fonts:/usr/share/fonts/TTF

# gstreamer mp3 æ ‡ç­¾ä¸­æ–‡è®¾ç½®{{{2
export GST_ID3_TAG_ENCODING=GB18030:UTF-8
export GST_ID3V2_TAG_ENCODING=GB18030:UTF-8

# å›¾å½¢ç»ˆç«¯ä¸‹(åŒ…æ‹¬sshç™»å½•æ—¶)çš„è®¾ç½®{{{2
# é»˜è®¤æµè§ˆå™¨
if [[ -n $DISPLAY && -z $SSH_CONNECTION ]]; then
  export BROWSER=firefox
  export wiki_browser=firefox
fi
if [[ -n $DISPLAY || -n $SSH_CONNECTION ]]; then
  # è®© less å°†ç²—ä½“/ä¸‹åˆ’çº¿ç­‰æ˜¾ç¤ºä¸ºå½©è‰²
  export LESS_TERMCAP_mb=$'\x1b[01;31m'
  export LESS_TERMCAP_md=$'\x1b[01;38;5;74m'
  export LESS_TERMCAP_me=$'\x1b[0m'
  export LESS_TERMCAP_se=$'\x1b[0m'
  export LESS_TERMCAP_so=$'\x1b[7m'
  export LESS_TERMCAP_ue=$'\x1b[0m'
  export LESS_TERMCAP_us=$'\x1b[04;38;5;146m'

  if [[ $TERM == linux ]]; then
    ;
  else
    [[ $TERM != *color* ]] && export TERM=${TERM%%[.-]*}-256color
  fi
else
  # tty ä¸‹å…‰æ ‡æ˜¾ç¤ºä¸ºå—çŠ¶
  echo -ne "\e[?6c"
  zshexit () {
    [[ $SHLVL -eq 1 ]] && echo -ne "\e[?0c"
  }
fi
if [[ "$OS" = Linux ]]; then
  # under fbterm
  # can't see parent on some restricted systems
  if [[ -d /proc/$PPID ]] && command grep -q '\(^\|/\)fbterm' /proc/$PPID/cmdline; then
    export TERM=fbterm
    export LANG=zh_CN.UTF-8
  fi
fi
# ä¸åŒçš„ OS {{{2
if [[ $OS != *BSD ]]; then
  # FreeBSD å’Œ OpenBSD ä¸Šï¼ŒMANPATH ä¼šè¦†ç›–é»˜è®¤çš„é…ç½®
  [ -d $HOME/.cabal/share/man ] && export MANPATH=:$HOME/.cabal/share/man
elif [[ $OS = FreeBSD ]]; then
  export PAGER=less
fi

# å…¶å®ƒç¨‹åº {{{3
AUTOJUMP_KEEP_SYMLINKS=1
export LESS="-FRX"

# other exports {{{2
export -TU PYTHONPATH pythonpath
export -U PATH

# å…¶å®ƒ {{{1

# Google doesn't know zsh very well :-(
[[ -f /usr/share/zsh/site-functions/_go ]] && source /usr/share/zsh/site-functions/_go
# When starting as a non-login shell
[[ -z $functions[j] && -f /etc/profile.d/autojump.zsh ]] && source /etc/profile.d/autojump.zsh

unset OS
unset _zdir
setopt nomatch

# some more git aliases
alias g='git'
alias gst='git status'
alias ga='git add'
alias ga.='git add .'
alias gcv='git commit -v'
alias gpho='git push origin'
alias gplo='git pull origin'
alias gphom='git push origin master'
alias gplom='git pull origin master'
alias gphod='git push origin develop'
alias gplod='git pull origin develop'
